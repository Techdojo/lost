function SfxrParams(){this.setSettings=function(e){for(var t=0;t<24;t++)this[String.fromCharCode(97+t)]=e[t]||0;this.c<.01&&(this.c=.01);var s=this.b+this.c+this.e;if(s<.18){var i=.18/s;this.b*=i,this.c*=i,this.e*=i}}}function SfxrSynth(){this._params=new SfxrParams;var e,t,s,i,r,h,a,n,o,c,d,l;this.reset=function(){var e=this._params;i=100/(e.f*e.f+.001),r=100/(e.g*e.g+.001),h=1-e.h*e.h*e.h*.01,a=-e.i*e.i*e.i*1e-6,e.a||(d=.5-e.n/2,l=5e-5*-e.o),n=1+e.l*e.l*(e.l>0?-.9:10),o=0,c=1==e.m?0:(1-e.m)*(1-e.m)*2e4+32},this.totalReset=function(){this.reset();var i=this._params;return e=i.b*i.b*1e5,t=i.c*i.c*1e5,s=i.e*i.e*1e5+12,3*((e+t+s)/3|0)},this.synthWave=function(w,m){var f=this._params,p=1!=f.s||f.v,x=f.v*f.v*.1,u=1+3e-4*f.w,y=f.s*f.s*f.s*.1,v=1+1e-4*f.t,b=1!=f.s,g=f.x*f.x,G=f.g,k=f.q||f.r,S=f.r*f.r*f.r*.2,V=f.q*f.q*(f.q<0?-1020:1020),M=f.p?32+((1-f.p)*(1-f.p)*2e4|0):0,E=f.d,C=f.j/2,I=f.k*f.k*.01,P=f.a,R=e,q=1/e,B=1/t,A=1/s,j=5/(1+f.u*f.u*20)*(.01+y);j>.8&&(j=.8),j=1-j;for(var U,D,L,_,H,W,J=!1,z=0,F=0,K=0,N=0,O=0,Q=0,T=0,X=0,Y=0,Z=0,$=new Array(1024),ee=new Array(32),te=$.length;te--;)$[te]=0;for(te=ee.length;te--;)ee[te]=2*Math.random()-1;for(te=0;te<m;te++){if(J)return te;if(M&&++Y>=M&&(Y=0,this.reset()),c&&++o>=c&&(c=0,i*=n),h+=a,(i*=h)>r&&(i=r,G>0&&(J=!0)),D=i,C>0&&(Z+=I,D*=1+Math.sin(Z)*C),(D|=0)<8&&(D=8),P||((d+=l)<0?d=0:d>.5&&(d=.5)),++F>R)switch(F=0,++z){case 1:R=t;break;case 2:R=s}switch(z){case 0:K=F*q;break;case 1:K=1+2*(1-F*B)*E;break;case 2:K=1-F*A;break;case 3:K=0,J=!0}k&&((L=0|(V+=S))<0?L=-L:L>1023&&(L=1023)),p&&u&&((x*=u)<1e-5?x=1e-5:x>.1&&(x=.1)),W=0;for(var se=8;se--;){if(++T>=D&&(T%=D,3==P))for(var ie=ee.length;ie--;)ee[ie]=2*Math.random()-1;switch(P){case 0:H=T/D<d?.5:-.5;break;case 1:H=1-T/D*2;break;case 2:H=.225*(((H=1.27323954*(_=6.28318531*((_=T/D)>.5?_-1:_))+.405284735*_*_*(_<0?1:-1))<0?-1:1)*H*H-H)+H;break;case 3:H=ee[Math.abs(32*T/D|0)]}p&&(U=Q,(y*=v)<0?y=0:y>.1&&(y=.1),b?(O+=(H-Q)*y,O*=j):(Q=H,O=0),N+=(Q+=O)-U,H=N*=1-x),k&&($[X%1024]=H,H+=$[(X-L+1024)%1024],X++),W+=H}W*=.125*K*g,w[te]=W>=1?32767:W<=-1?-32768:32767*W|0}return m}}var synth=new SfxrSynth,jsfxr=function(e){synth._params.setSettings(e);var t=synth.totalReset(),s=new Uint8Array(4*((t+1)/2|0)+44),i=2*synth.synthWave(new Uint16Array(s.buffer,44),t),r=new Uint32Array(s.buffer,0,44);r[0]=1179011410,r[1]=i+36,r[2]=1163280727,r[3]=544501094,r[4]=16,r[5]=65537,r[6]=44100,r[7]=88200,r[8]=1048578,r[9]=1635017060,r[10]=i,i+=44;for(var h=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="data:audio/wav;base64,";h<i;h+=3){var o=s[h]<<16|s[h+1]<<8|s[h+2];n+=a[o>>18]+a[o>>12&63]+a[o>>6&63]+a[63&o]}return n};"function"==typeof require?module.exports=jsfxr:this.jsfxr=jsfxr;var Game;!function(e){class t{constructor(e,t,s){this.pos=e,this.w=t,this.h=s}test(e){return this.pos.x<e.pos.x+e.w&&this.pos.x+this.w>e.pos.x&&this.pos.y<e.pos.y+e.h&&this.h+this.pos.y>e.pos.y}intersect(s){let i=Math.round(this.pos.x),r=Math.round(this.pos.y),h=i+this.w,a=r+this.h,n=Math.round(s.pos.x),o=Math.round(s.pos.y),c=n+s.w,d=o+s.h,l=i<n?n:i,w=r<o?o:r,m=h<c?h:c,f=a<d?a:d;return new t(new e.Vec(l,w),m-l,f-w)}clone(){return new t(this.pos.clone(),this.w,this.h)}}e.Box=t}(Game||(Game={}));var Game;!function(e){class t{constructor(t,s,i){this.collided=new e.Vec(0,0),this.frame=0,this.walk=!1,this.box=new e.Box(t,16,16),this.speed=s,this.sprite=i}render(e){this.sprite.render(e,this.box,0,3!=this.frame?this.frame:1)}update(e){e%8==0&&(this.frame=++this.frame%3),this.collided.y&&(this.speed.y=-this.speed.y),this.collided.x&&(this.speed.x=-this.speed.x)}}e.Enemy=t}(Game||(Game={}));var Game;!function(e){class t{constructor(t,s,i){this.collided=new e.Vec(0,0),this.face=0,this.walk=!0,this.frame=1,this.sprite=i,this.speed=new e.Vec(0,1),this.box=new e.Box(new e.Vec(t,s),16,24)}render(e){let t=this.box,s=this.face*t.h,i=this.frame;this.walk?(i=i<3?i:1,this.sprite.render(e,t,s,i+1)):this.sprite.render(e,t,s,0)}renderJet(e){this.walk||this.sprite.render(e,this.box,this.face*this.box.h,this.frame+4)}update(e){e%8==0&&(this.walk?0!=this.speed.x&&(this.frame=++this.frame%4):this.frame=++this.frame%3)}}e.Hero=t}(Game||(Game={}));var Game;!function(e){class t{constructor(t,s,i,r){this.box=new e.Box(new e.Vec(t,s),i,r)}render(e,t){const s=this.box;e.fillStyle="#0ff",e.fillRect(s.pos.x,s.pos.y,s.w,s.h)}}e.Platform=t}(Game||(Game={}));var Game;!function(e){class t{constructor(t,s){this.tick=0,this.width=256,this.ictx=t,this.sprite=new e.Sprite(s,this.width),this.hero=new e.Hero(96,160,this.sprite.crop(t,0,0,112,48)),this.ship=new e.Ship(160,136,this.sprite.crop(t,0,88,48,48)),this.platforms=[new e.Platform(-50,0,350,16),new e.Platform(32,72,48,8),new e.Platform(120,96,32,8),new e.Platform(192,48,48,8),new e.Platform(-50,184,350,8)];let i=this.sprite.crop(t,0,48,48,16),r=new e.Vec(.5,-.5);this.enemies=[new e.Enemy(new e.Vec(0,20),r.clone(),i),new e.Enemy(new e.Vec(0,60),r.clone(),i),new e.Enemy(new e.Vec(0,100),r.clone(),i),new e.Enemy(new e.Vec(0,140),r.clone(),i)]}back(e){if(this.cache)return void e.drawImage(this.cache,0,0);let t=e.createLinearGradient(0,0,0,192);t.addColorStop(0,"#002"),t.addColorStop(1,"#224"),e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height);for(let t=1;t<this.platforms.length;t++){let s=this.platforms[t].box.clone(),i=Math.round(s.w/8)-1;s.w=8,this.sprite.render(e,s,80,0);for(let t=1;t<i;t++)s.pos.x+=s.w,this.sprite.render(e,s,80,1);s.pos.x+=s.w,this.sprite.render(e,s,80,2)}this.cache=new Image,this.cache.src=e.canvas.toDataURL()}render(e){this.back(e),this.ship.render(e),this.hero.render(e),this.hero.renderJet(e),this.enemies.forEach(t=>{t.render(e)})}update(){let e=this.hero;e.update(this.tick),this.move(e);for(let t=0;t<this.enemies.length;t++){let s=this.enemies[t];s.update(this.tick),this.move(s),this.collide(e,s)&&this.enemies.splice(t,1)}this.tick++}collide(e,t){let s=this.ictx,i=this.width,r=e.box.clone(),h=t.box.clone(),a=!1;if(!r.test(h)&&(r.pos.x+r.w>i&&(r.pos.x-=i,a=!0),h.pos.x+h.w>i&&(h.pos.x-=i,a=!0),!a||!r.test(h)))return!1;let n=r.intersect(h),o=Math.round(n.pos.x),c=Math.round(n.pos.y),d=n.w+1,l=n.h+1;s.clearRect(o,c,d,l),e.render(s);let w=s.getImageData(o,c,d,l);s.clearRect(o,c,d,l),t.render(s);let m=s.getImageData(o,c,d,l),f=w.data.length;for(let e=3;e<f;e+=12)if(w.data[e]&&m.data[e])return!0;return!1}move(e){let t=e.collided,s=e.speed,i=e.box.pos,r=i.clone(),h=!1;i.x+=s.x,i.x>this.width?i.x-=this.width:i.x<0&&(i.x+=this.width),t.x=0,this.platforms.forEach(s=>{s.box.test(e.box)&&(i.x=r.x,t.x=1)}),i.y+=s.y,t.y=0,this.platforms.forEach(a=>{a.box.test(e.box)&&(i.y=r.y,t.y=1,s.y>0&&(h=!0))}),e.walk=h}}e.Scene=t}(Game||(Game={}));var Game;!function(e){class t{constructor(t,s,i){this.sprite=i,this.boxes=[new e.Box(new e.Vec(t,s),16,16),new e.Box(new e.Vec(t,s+16),16,16),new e.Box(new e.Vec(t,s+32),16,16)]}render(e){this.boxes.forEach((t,s)=>{this.sprite.render(e,t,t.h*s,0)})}}e.Ship=t}(Game||(Game={}));var Game;!function(e){class t{constructor(e,t){this.img=e,this.width=t}render(e,t,s,i){let r=t.pos,h=r.x,a=r.y,n=t.w,o=t.h;e.drawImage(this.img,n*i,s,n,o,h,a,n,o),h+n>this.width&&e.drawImage(this.img,n*i,s,n,o,h-this.width,a,n,o)}crop(e,s,i,r,h,a=!1,n=!1){let o=new Image,c=e.canvas,d=c.width,l=c.height;return c.width=r,c.height=h,e.save(),e.translate(a?r:0,n?h:0),e.scale(a?-1:1,n?-1:1),e.drawImage(this.img,-s,-i),e.restore(),o.src=c.toDataURL(),c.width=d,c.height=l,new t(o,this.width)}}e.Sprite=t}(Game||(Game={}));var Game;!function(e){class t{constructor(e,t){this.x=e,this.y=t}clone(){return new t(this.x,this.y)}}e.Vec=t}(Game||(Game={}));var Game;!function(e){function t(e,t){return(t||document).querySelector(e)}function s(e,t,s){e.addEventListener(t,s,!1)}function i(){let e=document.body,t=e.clientWidth/e.clientHeight<a.width/a.height;a.style.width=t?"100%":"",a.style.height=t?"":"100%"}function r(){const e=o.hero;s(document,"keydown",t=>{let s=t.keyCode;38==s||87==s||119==s?e.speed.y=-1:37==s||65==s||97==s?(e.speed.x=-1,e.face=0):39!=s&&68!=s&&100!=s||(e.speed.x=1,e.face=1)}),s(document,"keyup",t=>{let s=t.keyCode;38==s||87==s||119==s||40==s||83==s||115==s?e.speed.y=1:37!=s&&65!=s&&97!=s&&39!=s&&68!=s&&100!=s||(e.speed.x=0)}),s(window,"resize",i)}function h(){requestAnimationFrame(()=>{h()}),o.update(),o.render(n)}let a,n,o;s(window,"load",()=>{a=t("#game"),n=a.getContext("2d"),o=new e.Scene(t("#test").getContext("2d"),t("#sprite")),r(),i(),h()})}(Game||(Game={}));