function SfxrParams(){this.setSettings=function(e){for(var t=0;t<24;t++)this[String.fromCharCode(97+t)]=e[t]||0;this.c<.01&&(this.c=.01);var s=this.b+this.c+this.e;if(s<.18){var r=.18/s;this.b*=r,this.c*=r,this.e*=r}}}function SfxrSynth(){this._params=new SfxrParams;var e,t,s,r,i,a,h,n,o,c,d,m;this.reset=function(){var e=this._params;r=100/(e.f*e.f+.001),i=100/(e.g*e.g+.001),a=1-e.h*e.h*e.h*.01,h=-e.i*e.i*e.i*1e-6,e.a||(d=.5-e.n/2,m=5e-5*-e.o),n=1+e.l*e.l*(e.l>0?-.9:10),o=0,c=1==e.m?0:(1-e.m)*(1-e.m)*2e4+32},this.totalReset=function(){this.reset();var r=this._params;return e=r.b*r.b*1e5,t=r.c*r.c*1e5,s=r.e*r.e*1e5+12,3*((e+t+s)/3|0)},this.synthWave=function(l,u){var p=this._params,f=1!=p.s||p.v,w=p.v*p.v*.1,x=1+3e-4*p.w,y=p.s*p.s*p.s*.1,v=1+1e-4*p.t,G=1!=p.s,g=p.x*p.x,b=p.g,S=p.q||p.r,A=p.r*p.r*p.r*.2,k=p.q*p.q*(p.q<0?-1020:1020),B=p.p?32+((1-p.p)*(1-p.p)*2e4|0):0,M=p.d,j=p.j/2,Y=p.k*p.k*.01,E=p.a,R=e,P=1/e,O=1/t,C=1/s,q=5/(1+p.u*p.u*20)*(.01+y);q>.8&&(q=.8),q=1-q;for(var W,I,V,z,D,H,L=!1,T=0,Q=0,K=0,N=0,F=0,Z=0,J=0,U=0,X=0,_=0,$=new Array(1024),ee=new Array(32),te=$.length;te--;)$[te]=0;for(te=ee.length;te--;)ee[te]=2*Math.random()-1;for(te=0;te<u;te++){if(L)return te;if(B&&++X>=B&&(X=0,this.reset()),c&&++o>=c&&(c=0,r*=n),a+=h,(r*=a)>i&&(r=i,b>0&&(L=!0)),I=r,j>0&&(_+=Y,I*=1+Math.sin(_)*j),(I|=0)<8&&(I=8),E||((d+=m)<0?d=0:d>.5&&(d=.5)),++Q>R)switch(Q=0,++T){case 1:R=t;break;case 2:R=s}switch(T){case 0:K=Q*P;break;case 1:K=1+2*(1-Q*O)*M;break;case 2:K=1-Q*C;break;case 3:K=0,L=!0}S&&((V=0|(k+=A))<0?V=-V:V>1023&&(V=1023)),f&&x&&((w*=x)<1e-5?w=1e-5:w>.1&&(w=.1)),H=0;for(var se=8;se--;){if(++J>=I&&(J%=I,3==E))for(var re=ee.length;re--;)ee[re]=2*Math.random()-1;switch(E){case 0:D=J/I<d?.5:-.5;break;case 1:D=1-J/I*2;break;case 2:D=.225*(((D=1.27323954*(z=6.28318531*((z=J/I)>.5?z-1:z))+.405284735*z*z*(z<0?1:-1))<0?-1:1)*D*D-D)+D;break;case 3:D=ee[Math.abs(32*J/I|0)]}f&&(W=Z,(y*=v)<0?y=0:y>.1&&(y=.1),G?(F+=(D-Z)*y,F*=q):(Z=D,F=0),N+=(Z+=F)-W,D=N*=1-w),S&&($[U%1024]=D,D+=$[(U-V+1024)%1024],U++),H+=D}H*=.125*K*g,l[te]=H>=1?32767:H<=-1?-32768:32767*H|0}return u}}var synth=new SfxrSynth;window.jsfxr=function(e){synth._params.setSettings(e);var t=synth.totalReset(),s=new Uint8Array(4*((t+1)/2|0)+44),r=2*synth.synthWave(new Uint16Array(s.buffer,44),t),i=new Uint32Array(s.buffer,0,44);return i[0]=1179011410,i[1]=r+36,i[2]=1163280727,i[3]=544501094,i[4]=16,i[5]=65537,i[6]=44100,i[7]=88200,i[8]=1048578,i[9]=1635017060,i[10]=r,s.buffer};var Game;!function(e){class t{constructor(e,t,s){this.pos=e,this.w=t,this.h=s}test(e){return this.pos.x<e.pos.x+e.w&&this.pos.x+this.w>e.pos.x&&this.pos.y<e.pos.y+e.h&&this.h+this.pos.y>e.pos.y}intersect(s){let r=Math.round(this.pos.x),i=Math.round(this.pos.y),a=r+this.w,h=i+this.h,n=Math.round(s.pos.x),o=Math.round(s.pos.y),c=n+s.w,d=o+s.h,m=r<n?n:r,l=i<o?o:i,u=a<c?a:c,p=h<d?h:d;return new t(new e.Vec(m,l),u-m,p-l)}clone(){return new t(this.pos.clone(),this.w,this.h)}}e.Box=t}(Game||(Game={}));var Game;!function(e){class t{constructor(t){this.frame=0,this.end=!1,this.box=new e.Box(t,16,16)}render(e){this.frame<3&&t.sprite.render(e,this.box,1,this.frame)}update(e){e%4==0&&(this.end=++this.frame>2)}}e.Bumm=t}(Game||(Game={}));var Game;!function(e){class t{constructor(t,s,r=0){this.collided=new e.Vec(0,0),this.frame=0,this.box=new e.Box(t,16,16),this.speed=s,this.color=r}render(e){t.sprite.render(e,this.box,this.color,3!=this.frame?this.frame:1)}update(e){e%8==0&&(this.frame=++this.frame%3),this.collided.y&&(this.speed.y=-this.speed.y),this.collided.x&&(this.speed.x=-this.speed.x)}}e.Enemy=t}(Game||(Game={}));var Game;!function(e){class t{constructor(t,s){this.collided=new e.Vec(0,0),this.speed=new e.Vec(0,1),this.face=0,this.color=0,this.walk=!0,this.frame=1,this.lasers=[],this.box=new e.Box(new e.Vec(t,s),16,24)}render(e){let s=this.box,r=2*this.color+this.face,i=this.frame;this.walk?(i=i<3?i:1,t.sprite.render(e,s,r,i+1)):t.sprite.render(e,s,r,0),this.lasers.forEach(t=>{t.render(e)})}renderJet(e){this.walk||t.jetSprite.render(e,this.box,this.face+2,this.frame)}update(e){this.walk=this.collided.y&&this.speed.y>0,e%8==0&&(this.walk?0!=this.speed.x&&(this.frame=++this.frame%4):this.frame=++this.frame%3)}shot(){this.lasers.push(new e.Laser(this))}}e.Hero=t}(Game||(Game={}));var Game;!function(e){class t{constructor(t){let s=t.box.clone(),r=s.pos,i=new e.Vec(-1,0);t.face?(i.x=1,r.x+=s.w):r.x-=112,r.y+=12,s.h=1,s.w=112,this.box=s,this.speed=i}render(e){t.sprite.render(e,this.box,0,0)}update(e){}}e.Laser=t}(Game||(Game={}));var Game;!function(e){class t{constructor(t,s,r,i=0){this.box=new e.Box(new e.Vec(t,s),r,8),this.color=i}render(e){if(this.color<0)return;let s=this.color,r=this.box.clone(),i=Math.round(r.w/8)-1;r.w=8,t.sprite.render(e,r,s,0);for(let a=1;a<i;a++)r.pos.x+=r.w,t.sprite.render(e,r,s,1);r.pos.x+=r.w,t.sprite.render(e,r,s,2)}}e.Platform=t}(Game||(Game={}));var Game;!function(e){class t{constructor(t){this.tick=0,this.width=256,this.bumms=[],this.jetSound=null,this.sprite=t,this.hero=new e.Hero(96,160),this.ship=new e.Ship(160,136),this.initPlatforms(),this.initEnemies(),this.hero.shot()}ready(){return e.Sprite.load==e.Sprite.loaded}initPlatforms(){this.platforms=[new e.Platform(-50,0,350,-1),new e.Platform(32,72,48,1),new e.Platform(120,96,32,1),new e.Platform(192,48,48,1),new e.Platform(-50,184,350,2)]}initEnemies(){const t=new e.Vec(.5,-.5);this.enemies=[];for(let s=0;s<4;s++){let r=new e.Enemy(new e.Vec(0,40*s+20),t.clone(),s+1);this.enemies.push(r)}}back(e){if(this.cache)return void e.drawImage(this.cache,0,0);let t=e.createLinearGradient(0,0,0,192);t.addColorStop(0,"#002"),t.addColorStop(1,"#224"),e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height),this.platforms.forEach(t=>{t.render(e)}),this.cache=new Image,this.cache.src=e.canvas.toDataURL()}render(e){this.back(e),this.ship.render(e),this.hero.render(e),this.hero.renderJet(e),this.enemies.forEach(t=>{t.render(e)}),this.bumms.forEach(t=>{t.render(e)})}update(){let t=this.hero;this.move(t),t.update(this.tick),t.walk&&this.jetSound&&(this.jetSound.stop(),this.jetSound=null),t.walk||this.jetSound||(this.jetSound=e.Hero.jetSfx.play(.5,!0));let s=0;for(;s<this.enemies.length;){let r=this.enemies[s];r.update(this.tick),this.move(r),this.collide(t,r)?(this.enemies.splice(s,1),this.bumms.push(new e.Bumm(r.box.pos.clone())),e.Bumm.sfx.play()):s++}for(s=0;s<this.bumms.length;){let e=this.bumms[s];e.update(this.tick),e.end?this.bumms.splice(s,1):s++}this.tick++}collide(e,t){let s=this.sprite.ictx,r=this.width,i=e.box.clone(),a=t.box.clone(),h=!1;if(!i.test(a)&&(i.pos.x+i.w>r&&(i.pos.x-=r,h=!0),a.pos.x+a.w>r&&(a.pos.x-=r,h=!0),!h||!i.test(a)))return!1;let n=i.intersect(a),o=Math.round(n.pos.x),c=Math.round(n.pos.y),d=n.w+1,m=n.h+1;s.clearRect(o,c,d,m),e.render(s);let l=s.getImageData(o,c,d,m);s.clearRect(o,c,d,m),t.render(s);let u=s.getImageData(o,c,d,m),p=l.data.length;for(let e=3;e<p;e+=20)if(l.data[e]&&u.data[e])return!0;return!1}move(e){let t=e.collided,s=e.speed,r=e.box.pos,i=r.clone();r.x+=s.x,r.x>this.width?r.x-=this.width:r.x<0&&(r.x+=this.width),t.x=0,this.platforms.forEach(s=>{s.box.test(e.box)&&(r.x=i.x,t.x=1)}),r.y+=s.y,t.y=0,this.platforms.forEach(s=>{s.box.test(e.box)&&(r.y=i.y,t.y=1)})}}e.Scene=t}(Game||(Game={}));var Game;!function(e){class t{constructor(e){const s=jsfxr(e);t.ctx||(t.ctx=new AudioContext,t.master=t.ctx.createGain(),t.master.connect(t.ctx.destination)),t.ctx.decodeAudioData(s,e=>{this.buffer=e})}play(e=1,s=!1){const r=t.ctx.createGain(),i=t.ctx.createBufferSource();return r.connect(t.master),r.gain.value=e,i.loop=s,i.buffer=this.buffer,i.connect(r),i.start(t.ctx.currentTime),i}}e.Sfx=t}(Game||(Game={}));var Game;!function(e){class t{constructor(t,s){this.boxes=[new e.Box(new e.Vec(t,s),16,16),new e.Box(new e.Vec(t,s+16),16,16),new e.Box(new e.Vec(t,s+32),16,16)]}render(e){this.boxes.forEach((s,r)=>{t.sprite.render(e,s,r,0)})}}e.Ship=t}(Game||(Game={}));var Game;!function(e){class t{constructor(e,s,r,i=null){t.load++,this.img=new Image,this.img.onload=(()=>{t.loaded++,i&&i.call(this)}),this.img.src=s,this.ictx=e,this.width=r}render(e,t,s,r){let i=t.pos,a=i.x,h=i.y,n=t.w,o=t.h;s*=o,e.drawImage(this.img,n*r,s,n,o,a,h,n,o),a+n>this.width&&e.drawImage(this.img,n*r,s,n,o,a-this.width,h,n,o)}crop(e,s,r,i,a=[],h=!1,n=!1){let o=this.ictx,c=o.canvas,d=c.width,m=c.height,l=a.length;if(c.width=r,c.height=i*(l+1),o.save(),o.translate(h?r:0,n?i:0),o.scale(h?-1:1,n?-1:1),o.drawImage(this.img,e,s,r,i,0,0,r,i),o.restore(),l>0){const e=o.getImageData(0,0,c.width,c.height),t=e.data.length/(l+1);for(let s=0;s<t;s+=4)if(e.data[s+3])for(let r=0;r<4;r++)for(let i=0;i<l;i++){let h=e.data[s+r];a[i].length>r&&(h-=255-a[i][r]);let n=(i+1)*t+s+r;e.data[n]=h>0?h:0}o.putImageData(e,0,0)}const u=new t(o,c.toDataURL(),this.width);return c.width=d,c.height=m,u}}t.load=0,t.loaded=0,e.Sprite=t}(Game||(Game={}));var Game;!function(e){class t{constructor(e,t){this.x=e,this.y=t}clone(){return new t(this.x,this.y)}}e.Vec=t}(Game||(Game={}));var Game;!function(e){function t(e,t){return(t||document).querySelector(e)}function s(e,t,s){e.addEventListener(t,s,!1)}function r(){let e=document.body,t=e.clientWidth/e.clientHeight<h.width/h.height;h.style.width=t?"100%":"",h.style.height=t?"":"100%"}function i(){const e=o.hero;s(document,"keydown",t=>{let s=t.keyCode;38==s||87==s||119==s?e.speed.y=-1:37==s||65==s||97==s?(e.speed.x=-1,e.face=0):39!=s&&68!=s&&100!=s||(e.speed.x=1,e.face=1)}),s(document,"keyup",t=>{let s=t.keyCode;38==s||87==s||119==s||40==s||83==s||115==s?e.speed.y=1:37!=s&&65!=s&&97!=s&&39!=s&&68!=s&&100!=s||(e.speed.x=0)}),s(window,"resize",r)}function a(){requestAnimationFrame(()=>{a()}),o.ready()&&(o.update(),o.render(n))}let h,n,o;s(window,"load",()=>{h=t("#game"),n=h.getContext("2d");const s=t("#test").getContext("2d"),c=new e.Sprite(s,"data:image/gif;base64,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",h.width,()=>{e.Hero.sprite=c.crop(0,0,64,48,[]),e.Hero.jetSprite=c.crop(64,0,48,48,[[255,204,0]]),e.Bumm.sprite=c.crop(0,152,48,16,[[255,255,102]]),e.Platform.sprite=c.crop(0,80,24,8,[[0,204,0],[255,204,0]]),e.Enemy.sprite=c.crop(0,48,48,16,[[255,102,102],[255,102,255],[102,102,255],[102,255,255]]),e.Laser.sprite=c.crop(0,180,112,1,[[255,102,244],[255,102,102],[255,255,102],[102,255,255],[102,255,102]]),e.Ship.sprite=c.crop(0,88,64,48,[[255,102,255]]),e.Hero.jetSfx=new e.Sfx([3,,1,,,.61,,1,1,,,-1,,,-1,,-.76,-.02,.456,0,.18,,-1,.5]),e.Bumm.sfx=new e.Sfx([3,,.38,.47,.29,.09,,,,,,,,,,.55,.34,-.13,1,,,,,.5]),o=new e.Scene(c),r(),i(),a()})})}(Game||(Game={}));