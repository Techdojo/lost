function SfxrParams(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var s=this.b+this.c+this.e;if(s<.18){var i=.18/s;this.b*=i,this.c*=i,this.e*=i}}}function SfxrSynth(){this._params=new SfxrParams;var t,e,s,i,r,a,h,n,o,c,d,l;this.reset=function(){var t=this._params;i=100/(t.f*t.f+.001),r=100/(t.g*t.g+.001),a=1-t.h*t.h*t.h*.01,h=-t.i*t.i*t.i*1e-6,t.a||(d=.5-t.n/2,l=5e-5*-t.o),n=1+t.l*t.l*(t.l>0?-.9:10),o=0,c=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var i=this._params;return t=i.b*i.b*1e5,e=i.c*i.c*1e5,s=i.e*i.e*1e5+12,3*((t+e+s)/3|0)},this.synthWave=function(m,A){var f=this._params,u=1!=f.s||f.v,x=f.v*f.v*.1,p=1+3e-4*f.w,w=f.s*f.s*f.s*.1,y=1+1e-4*f.t,b=1!=f.s,S=f.x*f.x,g=f.g,v=f.q||f.r,G=f.r*f.r*f.r*.2,k=f.q*f.q*(f.q<0?-1020:1020),D=f.p?32+((1-f.p)*(1-f.p)*2e4|0):0,P=f.d,V=f.j/2,j=f.k*f.k*.01,E=f.a,H=t,J=1/t,C=1/e,z=1/s,T=5/(1+f.u*f.u*20)*(.01+w);T>.8&&(T=.8),T=1-T;for(var Q,M,N,B,I,U,Z=!1,O=0,R=0,L=0,F=0,K=0,Y=0,X=0,W=0,q=0,_=0,$=new Array(1024),tt=new Array(32),et=$.length;et--;)$[et]=0;for(et=tt.length;et--;)tt[et]=2*Math.random()-1;for(et=0;et<A;et++){if(Z)return et;if(D&&++q>=D&&(q=0,this.reset()),c&&++o>=c&&(c=0,i*=n),a+=h,(i*=a)>r&&(i=r,g>0&&(Z=!0)),M=i,V>0&&(_+=j,M*=1+Math.sin(_)*V),(M|=0)<8&&(M=8),E||((d+=l)<0?d=0:d>.5&&(d=.5)),++R>H)switch(R=0,++O){case 1:H=e;break;case 2:H=s}switch(O){case 0:L=R*J;break;case 1:L=1+2*(1-R*C)*P;break;case 2:L=1-R*z;break;case 3:L=0,Z=!0}v&&((N=0|(k+=G))<0?N=-N:N>1023&&(N=1023)),u&&p&&((x*=p)<1e-5?x=1e-5:x>.1&&(x=.1)),U=0;for(var st=8;st--;){if(++X>=M&&(X%=M,3==E))for(var it=tt.length;it--;)tt[it]=2*Math.random()-1;switch(E){case 0:I=X/M<d?.5:-.5;break;case 1:I=1-X/M*2;break;case 2:I=.225*(((I=1.27323954*(B=6.28318531*((B=X/M)>.5?B-1:B))+.405284735*B*B*(B<0?1:-1))<0?-1:1)*I*I-I)+I;break;case 3:I=tt[Math.abs(32*X/M|0)]}u&&(Q=Y,(w*=y)<0?w=0:w>.1&&(w=.1),b?(K+=(I-Y)*w,K*=T):(Y=I,K=0),F+=(Y+=K)-Q,I=F*=1-x),v&&($[W%1024]=I,I+=$[(W-N+1024)%1024],W++),U+=I}U*=.125*L*S,m[et]=U>=1?32767:U<=-1?-32768:32767*U|0}return A}}var synth=new SfxrSynth;window.jsfxr=function(t){synth._params.setSettings(t);var e=synth.totalReset(),s=new Uint8Array(4*((e+1)/2|0)+44),i=2*synth.synthWave(new Uint16Array(s.buffer,44),e),r=new Uint32Array(s.buffer,0,44);return r[0]=1179011410,r[1]=i+36,r[2]=1163280727,r[3]=544501094,r[4]=16,r[5]=65537,r[6]=44100,r[7]=88200,r[8]=1048578,r[9]=1635017060,r[10]=i,s.buffer};var Game;!function(t){class e{constructor(t,e,s){this.pos=t,this.w=e,this.h=s}test(t){return this.pos.x<t.pos.x+t.w&&this.pos.x+this.w>t.pos.x&&this.pos.y<t.pos.y+t.h&&this.h+this.pos.y>t.pos.y}intersect(s){let i=Math.round(this.pos.x),r=Math.round(this.pos.y),a=i+this.w,h=r+this.h,n=Math.round(s.pos.x),o=Math.round(s.pos.y),c=n+s.w,d=o+s.h,l=i<n?n:i,m=r<o?o:r,A=a<c?a:c,f=h<d?h:d;return new e(new t.Vec(l,m),A-l,f-m)}clone(){return new e(this.pos.clone(),this.w,this.h)}}t.Box=e}(Game||(Game={}));var Game;!function(t){class e{constructor(e,s){this.frame=0,this.end=!1,this.box=new t.Box(e,16,16),this.sprite=s}render(t){this.frame<3&&this.sprite.render(t,this.box,1,this.frame)}update(t){t%4==0&&(this.end=++this.frame>2)}}t.Bumm=e}(Game||(Game={}));var Game;!function(t){class e{constructor(e,s,i,r=0){this.collided=new t.Vec(0,0),this.frame=0,this.walk=!1,this.box=new t.Box(e,16,16),this.speed=s,this.sprite=i,this.color=r}render(t){this.sprite.render(t,this.box,this.color,3!=this.frame?this.frame:1)}update(t){t%8==0&&(this.frame=++this.frame%3),this.collided.y&&(this.speed.y=-this.speed.y),this.collided.x&&(this.speed.x=-this.speed.x)}}t.Enemy=e}(Game||(Game={}));var Game;!function(t){class e{constructor(e,s,i,r){this.collided=new t.Vec(0,0),this.speed=new t.Vec(0,1),this.face=0,this.color=0,this.walk=!0,this.frame=1,this.jetSprite=r,this.sprite=i,this.box=new t.Box(new t.Vec(e,s),16,24)}render(t){let e=this.box,s=2*this.color+this.face,i=this.frame;this.walk?(i=i<3?i:1,this.sprite.render(t,e,s,i+1)):this.sprite.render(t,e,s,0)}renderJet(t){this.walk||this.jetSprite.render(t,this.box,this.face+2,this.frame)}update(t){t%8==0&&(this.walk?0!=this.speed.x&&(this.frame=++this.frame%4):this.frame=++this.frame%3)}}t.Hero=e}(Game||(Game={}));var Game;!function(t){class e{constructor(e,s,i,r,a=0){this.box=new t.Box(new t.Vec(e,s),i,8),this.sprite=r,this.color=a}render(t){if(!this.sprite)return;let e=this.color,s=this.box.clone(),i=Math.round(s.w/8)-1;s.w=8,this.sprite.render(t,s,e,0);for(let r=1;r<i;r++)s.pos.x+=s.w,this.sprite.render(t,s,e,1);s.pos.x+=s.w,this.sprite.render(t,s,e,2)}}t.Platform=e}(Game||(Game={}));var Game;!function(t){class e{constructor(e,s){this.tick=0,this.width=256,this.bumms=[],this.jetSound=null,this.ictx=e,this.sprite=s,this.bummSprite=s.crop(e,0,136,48,16,[[255,255,102,192]]),this.initHero(),this.initShip(),this.initPlatforms(),this.initEnemies(),this.bummSfx=new t.Sfx([3,,.38,.47,.29,.09,,,,,,,,,,.55,.34,-.13,1,,,,,.5]),this.jetSfx=new t.Sfx([3,,1,,.08,.61,,.76,.12,,-.96,-.14,.29,.34,-.91,,-.26,.01,.63,0,.18,,,.5])}ready(){return t.Sprite.load==t.Sprite.loaded}initHero(){const e=this.sprite.crop(this.ictx,0,0,64,48,[]),s=this.sprite.crop(this.ictx,64,0,48,48,[[255,204,0]]);this.hero=new t.Hero(96,160,e,s)}initShip(){const e=this.sprite.crop(this.ictx,0,88,64,48,[[255,102,255]]);this.ship=new t.Ship(160,136,e)}initPlatforms(){const e=this.sprite.crop(this.ictx,0,80,24,8,[[0,204,0],[255,204,0]]);this.platforms=[new t.Platform(-50,0,350,null),new t.Platform(32,72,48,e,1),new t.Platform(120,96,32,e,1),new t.Platform(192,48,48,e,1),new t.Platform(-50,184,350,e,2)]}initEnemies(){const e=new t.Vec(.5,-.5),s=this.sprite.crop(this.ictx,0,48,48,16,[[255,102,102,192],[255,102,255,192],[102,102,255,192],[102,255,255,192]]);this.enemies=[];for(let i=0;i<4;i++){let r=new t.Enemy(new t.Vec(0,40*i+20),e.clone(),s,i+1);this.enemies.push(r)}}back(t){if(this.cache)return void t.drawImage(this.cache,0,0);let e=t.createLinearGradient(0,0,0,192);e.addColorStop(0,"#002"),e.addColorStop(1,"#224"),t.fillStyle=e,t.fillRect(0,0,t.canvas.width,t.canvas.height),this.platforms.forEach(e=>{e.render(t)}),this.cache=new Image,this.cache.src=t.canvas.toDataURL()}render(t){this.back(t),this.ship.render(t),this.hero.render(t),this.hero.renderJet(t),this.enemies.forEach(e=>{e.render(t)}),this.bumms.forEach(e=>{e.render(t)})}update(){let e=this.hero;e.update(this.tick),this.move(e),e.walk&&this.jetSound&&(this.jetSound.stop(),this.jetSound=null),e.walk||this.jetSound||(this.jetSound=this.jetSfx.play(.5,!0));let s=0;for(;s<this.enemies.length;){let i=this.enemies[s];i.update(this.tick),this.move(i),this.collide(e,i)?(this.enemies.splice(s,1),this.bumms.push(new t.Bumm(i.box.pos.clone(),this.bummSprite)),this.bummSfx.play()):s++}for(s=0;s<this.bumms.length;){let t=this.bumms[s];t.update(this.tick),t.end?this.bumms.splice(s,1):s++}this.tick++}collide(t,e){let s=this.ictx,i=this.width,r=t.box.clone(),a=e.box.clone(),h=!1;if(!r.test(a)&&(r.pos.x+r.w>i&&(r.pos.x-=i,h=!0),a.pos.x+a.w>i&&(a.pos.x-=i,h=!0),!h||!r.test(a)))return!1;let n=r.intersect(a),o=Math.round(n.pos.x),c=Math.round(n.pos.y),d=n.w+1,l=n.h+1;s.clearRect(o,c,d,l),t.render(s);let m=s.getImageData(o,c,d,l);s.clearRect(o,c,d,l),e.render(s);let A=s.getImageData(o,c,d,l),f=m.data.length;for(let t=3;t<f;t+=20)if(m.data[t]&&A.data[t])return!0;return!1}move(t){let e=t.collided,s=t.speed,i=t.box.pos,r=i.clone(),a=!1;i.x+=s.x,i.x>this.width?i.x-=this.width:i.x<0&&(i.x+=this.width),e.x=0,this.platforms.forEach(s=>{s.box.test(t.box)&&(i.x=r.x,e.x=1)}),i.y+=s.y,e.y=0,this.platforms.forEach(h=>{h.box.test(t.box)&&(i.y=r.y,e.y=1,s.y>0&&(a=!0))}),t.walk=a}}t.Scene=e}(Game||(Game={}));var Game;!function(t){class e{constructor(t){const s=jsfxr(t);e.ctx||(e.ctx=new AudioContext,e.master=e.ctx.createGain(),e.master.connect(e.ctx.destination)),e.ctx.decodeAudioData(s,t=>{this.buffer=t})}play(t=1,s=!1){const i=e.ctx.createGain(),r=e.ctx.createBufferSource();return i.connect(e.master),i.gain.value=t,r.loop=s,r.buffer=this.buffer,r.connect(i),r.start(e.ctx.currentTime),r}}t.Sfx=e}(Game||(Game={}));var Game;!function(t){class e{constructor(e,s,i){this.sprite=i,this.boxes=[new t.Box(new t.Vec(e,s),16,16),new t.Box(new t.Vec(e,s+16),16,16),new t.Box(new t.Vec(e,s+32),16,16)]}render(t){this.boxes.forEach((e,s)=>{this.sprite.render(t,e,s,0)})}}t.Ship=e}(Game||(Game={}));var Game;!function(t){class e{constructor(t,s,i=null){e.load++,this.img=new Image,this.img.onload=(()=>{e.loaded++,i&&i.call(this)}),this.img.src=t,this.width=s}render(t,e,s,i){let r=e.pos,a=r.x,h=r.y,n=e.w,o=e.h;s*=o,t.drawImage(this.img,n*i,s,n,o,a,h,n,o),a+n>this.width&&t.drawImage(this.img,n*i,s,n,o,a-this.width,h,n,o)}crop(t,s,i,r,a,h=[],n=!1,o=!1){let c=t.canvas,d=c.width,l=c.height,m=h.length;if(c.width=r,c.height=a*(m+1),t.save(),t.translate(n?r:0,o?a:0),t.scale(n?-1:1,o?-1:1),t.drawImage(this.img,s,i,r,a,0,0,r,a),t.restore(),m>0){const e=t.getImageData(0,0,c.width,c.height),s=e.data.length/(m+1);for(let t=0;t<s;t+=4)if(e.data[t+3])for(let i=0;i<4;i++)for(let r=0;r<m;r++){let a=e.data[t+i];h[r].length>i&&(a-=255-h[r][i]);let n=(r+1)*s+t+i;e.data[n]=a>0?a:0}t.putImageData(e,0,0)}const A=new e(c.toDataURL(),this.width);return c.width=d,c.height=l,A}}e.load=0,e.loaded=0,t.Sprite=e}(Game||(Game={}));var Game;!function(t){class e{constructor(t,e){this.x=t,this.y=e}clone(){return new e(this.x,this.y)}}t.Vec=e}(Game||(Game={}));var Game;!function(t){function e(t,e){return(e||document).querySelector(t)}function s(t,e,s){t.addEventListener(e,s,!1)}function i(){let t=document.body,e=t.clientWidth/t.clientHeight<h.width/h.height;h.style.width=e?"100%":"",h.style.height=e?"":"100%"}function r(){const t=o.hero;s(document,"keydown",e=>{let s=e.keyCode;38==s||87==s||119==s?t.speed.y=-1:37==s||65==s||97==s?(t.speed.x=-1,t.face=0):39!=s&&68!=s&&100!=s||(t.speed.x=1,t.face=1)}),s(document,"keyup",e=>{let s=e.keyCode;38==s||87==s||119==s||40==s||83==s||115==s?t.speed.y=1:37!=s&&65!=s&&97!=s&&39!=s&&68!=s&&100!=s||(t.speed.x=0)}),s(window,"resize",i)}function a(){requestAnimationFrame(()=>{a()}),o.ready()&&(o.update(),o.render(n))}let h,n,o;s(window,"load",()=>{h=e("#game"),n=h.getContext("2d");const s=new t.Sprite("data:image/png;base64,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",h.width,()=>{o=new t.Scene(e("#test").getContext("2d"),s),i(),r(),a()})})}(Game||(Game={}));