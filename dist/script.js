function SfxrParams(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var s=this.b+this.c+this.e;if(s<.18){var i=.18/s;this.b*=i,this.c*=i,this.e*=i}}}function SfxrSynth(){this._params=new SfxrParams;var t,e,s,i,r,h,a,n,o,c,A,d;this.reset=function(){var t=this._params;i=100/(t.f*t.f+.001),r=100/(t.g*t.g+.001),h=1-t.h*t.h*t.h*.01,a=-t.i*t.i*t.i*1e-6,t.a||(A=.5-t.n/2,d=5e-5*-t.o),n=1+t.l*t.l*(t.l>0?-.9:10),o=0,c=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var i=this._params;return t=i.b*i.b*1e5,e=i.c*i.c*1e5,s=i.e*i.e*1e5+12,3*((t+e+s)/3|0)},this.synthWave=function(l,p){var m=this._params,f=1!=m.s||m.v,w=m.v*m.v*.1,u=1+3e-4*m.w,x=m.s*m.s*m.s*.1,y=1+1e-4*m.t,g=1!=m.s,v=m.x*m.x,b=m.g,G=m.q||m.r,S=m.r*m.r*m.r*.2,k=m.q*m.q*(m.q<0?-1020:1020),W=m.p?32+((1-m.p)*(1-m.p)*2e4|0):0,C=m.d,V=m.j/2,D=m.k*m.k*.01,R=m.a,L=t,Q=1/t,B=1/e,M=1/s,E=5/(1+m.u*m.u*20)*(.01+x);E>.8&&(E=.8),E=1-E;for(var U,X,q,H,I,J,T=!1,K=0,F=0,P=0,z=0,j=0,O=0,Z=0,Y=0,N=0,_=0,$=new Array(1024),tt=new Array(32),et=$.length;et--;)$[et]=0;for(et=tt.length;et--;)tt[et]=2*Math.random()-1;for(et=0;et<p;et++){if(T)return et;if(W&&++N>=W&&(N=0,this.reset()),c&&++o>=c&&(c=0,i*=n),h+=a,(i*=h)>r&&(i=r,b>0&&(T=!0)),X=i,V>0&&(_+=D,X*=1+Math.sin(_)*V),(X|=0)<8&&(X=8),R||((A+=d)<0?A=0:A>.5&&(A=.5)),++F>L)switch(F=0,++K){case 1:L=e;break;case 2:L=s}switch(K){case 0:P=F*Q;break;case 1:P=1+2*(1-F*B)*C;break;case 2:P=1-F*M;break;case 3:P=0,T=!0}G&&((q=0|(k+=S))<0?q=-q:q>1023&&(q=1023)),f&&u&&((w*=u)<1e-5?w=1e-5:w>.1&&(w=.1)),J=0;for(var st=8;st--;){if(++Z>=X&&(Z%=X,3==R))for(var it=tt.length;it--;)tt[it]=2*Math.random()-1;switch(R){case 0:I=Z/X<A?.5:-.5;break;case 1:I=1-Z/X*2;break;case 2:I=.225*(((I=1.27323954*(H=6.28318531*((H=Z/X)>.5?H-1:H))+.405284735*H*H*(H<0?1:-1))<0?-1:1)*I*I-I)+I;break;case 3:I=tt[Math.abs(32*Z/X|0)]}f&&(U=O,(x*=y)<0?x=0:x>.1&&(x=.1),g?(j+=(I-O)*x,j*=E):(O=I,j=0),z+=(O+=j)-U,I=z*=1-w),G&&($[Y%1024]=I,I+=$[(Y-q+1024)%1024],Y++),J+=I}J*=.125*P*v,l[et]=J>=1?32767:J<=-1?-32768:32767*J|0}return p}}var synth=new SfxrSynth,jsfxr=function(t){synth._params.setSettings(t);var e=synth.totalReset(),s=new Uint8Array(4*((e+1)/2|0)+44),i=2*synth.synthWave(new Uint16Array(s.buffer,44),e),r=new Uint32Array(s.buffer,0,44);r[0]=1179011410,r[1]=i+36,r[2]=1163280727,r[3]=544501094,r[4]=16,r[5]=65537,r[6]=44100,r[7]=88200,r[8]=1048578,r[9]=1635017060,r[10]=i,i+=44;for(var h=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="data:audio/wav;base64,";h<i;h+=3){var o=s[h]<<16|s[h+1]<<8|s[h+2];n+=a[o>>18]+a[o>>12&63]+a[o>>6&63]+a[63&o]}return n};"function"==typeof require?module.exports=jsfxr:this.jsfxr=jsfxr;var Game;!function(t){class e{constructor(t,e,s){this.pos=t,this.w=e,this.h=s}test(t){return this.pos.x<t.pos.x+t.w&&this.pos.x+this.w>t.pos.x&&this.pos.y<t.pos.y+t.h&&this.h+this.pos.y>t.pos.y}intersect(s){let i=Math.round(this.pos.x),r=Math.round(this.pos.y),h=i+this.w,a=r+this.h,n=Math.round(s.pos.x),o=Math.round(s.pos.y),c=n+s.w,A=o+s.h,d=i<n?n:i,l=r<o?o:r,p=h<c?h:c,m=a<A?a:A;return new e(new t.Vec(d,l),p-d,m-l)}clone(){return new e(this.pos.clone(),this.w,this.h)}}t.Box=e}(Game||(Game={}));var Game;!function(t){class e{constructor(e,s,i,r=0,h=0){this.collided=new t.Vec(0,0),this.frame=0,this.walk=!1,this.box=new t.Box(e,16,16),this.speed=s,this.sprite=i,this.type=r,this.color=h}render(t){let e=this.type+2*this.color;this.sprite.render(t,this.box,e,3!=this.frame?this.frame:1)}update(t){t%8==0&&(this.frame=++this.frame%3),this.collided.y&&(this.speed.y=-this.speed.y),this.collided.x&&(this.speed.x=-this.speed.x)}}t.Enemy=e}(Game||(Game={}));var Game;!function(t){class e{constructor(e,s,i,r){this.collided=new t.Vec(0,0),this.face=0,this.color=0,this.walk=!0,this.frame=1,this.jetSprite=r,this.sprite=i,this.speed=new t.Vec(0,1),this.box=new t.Box(new t.Vec(e,s),16,24)}render(t){let e=this.box,s=2*this.color+this.face,i=this.frame;this.walk?(i=i<3?i:1,this.sprite.render(t,e,s,i+1)):this.sprite.render(t,e,s,0)}renderJet(t){this.walk||this.jetSprite.render(t,this.box,this.face+2,this.frame)}update(t){t%8==0&&(this.walk?0!=this.speed.x&&(this.frame=++this.frame%4):this.frame=++this.frame%3)}}t.Hero=e}(Game||(Game={}));var Game;!function(t){class e{constructor(e,s,i,r,h=0){this.box=new t.Box(new t.Vec(e,s),i,8),this.sprite=r,this.color=h}render(t){if(!this.sprite)return;let e=this.color,s=this.box.clone(),i=Math.round(s.w/8)-1;s.w=8,this.sprite.render(t,s,e,0);for(let r=1;r<i;r++)s.pos.x+=s.w,this.sprite.render(t,s,e,1);s.pos.x+=s.w,this.sprite.render(t,s,e,2)}}t.Platform=e}(Game||(Game={}));var Game;!function(t){class e{constructor(t,e){this.tick=0,this.width=256,this.ictx=t,this.sprite=e,this.initHero(),this.initShip(),this.initPlatforms(),this.initEnemies()}initHero(){const e=this.sprite.crop(this.ictx,0,0,64,48),s=this.sprite.crop(this.ictx,64,0,48,48,[[255,204,0]]);this.hero=new t.Hero(96,160,e,s)}initShip(){const e=this.sprite.crop(this.ictx,0,88,64,48,[[255,102,255]]);this.ship=new t.Ship(160,136,e)}initPlatforms(){const e=this.sprite.crop(this.ictx,0,80,24,8,[[0,204,0],[255,204,0]]);this.platforms=[new t.Platform(-50,0,350,null),new t.Platform(32,72,48,e,1),new t.Platform(120,96,32,e,1),new t.Platform(192,48,48,e,1),new t.Platform(-50,184,350,e,2)]}initEnemies(){const e=new t.Vec(.5,-.5),s=this.sprite.crop(this.ictx,0,48,48,32,[[255,102,102],[255,102,255],[102,102,255],[102,255,255]]);this.enemies=[];for(let i=0;i<4;i++){let r=new t.Enemy(new t.Vec(0,40*i+20),e.clone(),s,0,i+1);this.enemies.push(r)}}back(t){if(this.cache)return void t.drawImage(this.cache,0,0);let e=t.createLinearGradient(0,0,0,192);e.addColorStop(0,"#002"),e.addColorStop(1,"#224"),t.fillStyle=e,t.fillRect(0,0,t.canvas.width,t.canvas.height),this.platforms.forEach(e=>{e.render(t)}),this.cache=new Image,this.cache.src=t.canvas.toDataURL()}render(t){this.back(t),this.ship.render(t),this.hero.render(t),this.hero.renderJet(t),this.enemies.forEach(e=>{e.render(t)})}update(){let t=this.hero;t.update(this.tick),this.move(t);for(let e=0;e<this.enemies.length;e++){let s=this.enemies[e];s.update(this.tick),this.move(s),this.collide(t,s)&&this.enemies.splice(e,1)}this.tick++}collide(t,e){let s=this.ictx,i=this.width,r=t.box.clone(),h=e.box.clone(),a=!1;if(!r.test(h)&&(r.pos.x+r.w>i&&(r.pos.x-=i,a=!0),h.pos.x+h.w>i&&(h.pos.x-=i,a=!0),!a||!r.test(h)))return!1;let n=r.intersect(h),o=Math.round(n.pos.x),c=Math.round(n.pos.y),A=n.w+1,d=n.h+1;s.clearRect(o,c,A,d),t.render(s);let l=s.getImageData(o,c,A,d);s.clearRect(o,c,A,d),e.render(s);let p=s.getImageData(o,c,A,d),m=l.data.length;for(let t=3;t<m;t+=20)if(l.data[t]&&p.data[t])return!0;return!1}move(t){let e=t.collided,s=t.speed,i=t.box.pos,r=i.clone(),h=!1;i.x+=s.x,i.x>this.width?i.x-=this.width:i.x<0&&(i.x+=this.width),e.x=0,this.platforms.forEach(s=>{s.box.test(t.box)&&(i.x=r.x,e.x=1)}),i.y+=s.y,e.y=0,this.platforms.forEach(a=>{a.box.test(t.box)&&(i.y=r.y,e.y=1,s.y>0&&(h=!0))}),t.walk=h}}t.Scene=e}(Game||(Game={}));var Game;!function(t){class e{constructor(e,s,i){this.sprite=i,this.boxes=[new t.Box(new t.Vec(e,s),16,16),new t.Box(new t.Vec(e,s+16),16,16),new t.Box(new t.Vec(e,s+32),16,16)]}render(t){this.boxes.forEach((e,s)=>{this.sprite.render(t,e,s,0)})}}t.Ship=e}(Game||(Game={}));var Game;!function(t){class e{constructor(t,e,s=null){this.loaded=!1,this.img=new Image,this.img.onload=(()=>{this.loaded=!0,s&&s.call(this)}),this.img.src=t,this.width=e}render(t,e,s,i){let r=e.pos,h=r.x,a=r.y,n=e.w,o=e.h;s*=o,t.drawImage(this.img,n*i,s,n,o,h,a,n,o),h+n>this.width&&t.drawImage(this.img,n*i,s,n,o,h-this.width,a,n,o)}crop(t,s,i,r,h,a=[],n=null,o=!1,c=!1){let A=t.canvas,d=A.width,l=A.height,p=a.length;if(A.width=r,A.height=h*(p+1),t.save(),t.translate(o?r:0,c?h:0),t.scale(o?-1:1,c?-1:1),t.drawImage(this.img,s,i,r,h,0,0,r,h),t.restore(),p>0){const e=t.getImageData(0,0,A.width,A.height),s=e.data.length/(p+1);for(let t=0;t<s;t+=4)if(e.data[t+3])for(let i=0;i<4;i++)for(let r=0;r<p;r++){let h=e.data[t+i];a[r].length>i&&(h-=255-a[r][i]);let n=(r+1)*s+t+i;e.data[n]=h>0?h:0}t.putImageData(e,0,0)}const m=new e(A.toDataURL(),this.width,n);return A.width=d,A.height=l,m}}t.Sprite=e}(Game||(Game={}));var Game;!function(t){class e{constructor(t,e){this.x=t,this.y=e}clone(){return new e(this.x,this.y)}}t.Vec=e}(Game||(Game={}));var Game;!function(t){function e(t,e){return(e||document).querySelector(t)}function s(t,e,s){t.addEventListener(e,s,!1)}function i(){let t=document.body,e=t.clientWidth/t.clientHeight<a.width/a.height;a.style.width=e?"100%":"",a.style.height=e?"":"100%"}function r(){const t=o.hero;s(document,"keydown",e=>{let s=e.keyCode;38==s||87==s||119==s?t.speed.y=-1:37==s||65==s||97==s?(t.speed.x=-1,t.face=0):39!=s&&68!=s&&100!=s||(t.speed.x=1,t.face=1)}),s(document,"keyup",e=>{let s=e.keyCode;38==s||87==s||119==s||40==s||83==s||115==s?t.speed.y=1:37!=s&&65!=s&&97!=s&&39!=s&&68!=s&&100!=s||(t.speed.x=0)}),s(window,"resize",i)}function h(){requestAnimationFrame(()=>{h()}),o.update(),o.render(n)}let a,n,o;s(window,"load",()=>{a=e("#game"),n=a.getContext("2d");const s=e("#test").getContext("2d"),c=new t.Sprite("data:image/png;base64,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",a.width,function(){o=new t.Scene(s,c),i(),r(),h()})})}(Game||(Game={}));