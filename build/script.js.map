{"version":3,"sources":["node_modules/jsfxr/jsfxr.js","src/Game/Box.ts","src/Game/Hero.ts","src/Game/Platform.ts","src/Game/Scene.ts","src/Game/Ship.ts","src/Game/Sprite.ts","src/Game/Vec.ts","src/script.ts"],"names":[],"mappings":"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","file":"script.js","sourcesContent":["/**\n * SfxrParams\n *\n * Copyright 2010 Thomas Vian\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @author Thomas Vian\n */\n/** @constructor */\nfunction SfxrParams() {\n  //--------------------------------------------------------------------------\n  //\n  //  Settings String Methods\n  //\n  //--------------------------------------------------------------------------\n\n  /**\n   * Parses a settings array into the parameters\n   * @param array Array of the settings values, where elements 0 - 23 are\n   *                a: waveType\n   *                b: attackTime\n   *                c: sustainTime\n   *                d: sustainPunch\n   *                e: decayTime\n   *                f: startFrequency\n   *                g: minFrequency\n   *                h: slide\n   *                i: deltaSlide\n   *                j: vibratoDepth\n   *                k: vibratoSpeed\n   *                l: changeAmount\n   *                m: changeSpeed\n   *                n: squareDuty\n   *                o: dutySweep\n   *                p: repeatSpeed\n   *                q: phaserOffset\n   *                r: phaserSweep\n   *                s: lpFilterCutoff\n   *                t: lpFilterCutoffSweep\n   *                u: lpFilterResonance\n   *                v: hpFilterCutoff\n   *                w: hpFilterCutoffSweep\n   *                x: masterVolume\n   * @return If the string successfully parsed\n   */\n  this.setSettings = function(values)\n  {\n    for ( var i = 0; i < 24; i++ )\n    {\n      this[String.fromCharCode( 97 + i )] = values[i] || 0;\n    }\n\n    // I moved this here from the reset(true) function\n    if (this['c'] < .01) {\n      this['c'] = .01;\n    }\n\n    var totalTime = this['b'] + this['c'] + this['e'];\n    if (totalTime < .18) {\n      var multiplier = .18 / totalTime;\n      this['b']  *= multiplier;\n      this['c'] *= multiplier;\n      this['e']   *= multiplier;\n    }\n  }\n}\n\n/**\n * SfxrSynth\n *\n * Copyright 2010 Thomas Vian\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @author Thomas Vian\n */\n/** @constructor */\nfunction SfxrSynth() {\n  // All variables are kept alive through function closures\n\n  //--------------------------------------------------------------------------\n  //\n  //  Sound Parameters\n  //\n  //--------------------------------------------------------------------------\n\n  this._params = new SfxrParams();  // Params instance\n\n  //--------------------------------------------------------------------------\n  //\n  //  Synth Variables\n  //\n  //--------------------------------------------------------------------------\n\n  var _envelopeLength0, // Length of the attack stage\n      _envelopeLength1, // Length of the sustain stage\n      _envelopeLength2, // Length of the decay stage\n\n      _period,          // Period of the wave\n      _maxPeriod,       // Maximum period before sound stops (from minFrequency)\n\n      _slide,           // Note slide\n      _deltaSlide,      // Change in slide\n\n      _changeAmount,    // Amount to change the note by\n      _changeTime,      // Counter for the note change\n      _changeLimit,     // Once the time reaches this limit, the note changes\n\n      _squareDuty,      // Offset of center switching point in the square wave\n      _dutySweep;       // Amount to change the duty by\n\n  //--------------------------------------------------------------------------\n  //\n  //  Synth Methods\n  //\n  //--------------------------------------------------------------------------\n\n  /**\n   * Resets the runing variables from the params\n   * Used once at the start (total reset) and for the repeat effect (partial reset)\n   */\n  this.reset = function() {\n    // Shorter reference\n    var p = this._params;\n\n    _period       = 100 / (p['f'] * p['f'] + .001);\n    _maxPeriod    = 100 / (p['g']   * p['g']   + .001);\n\n    _slide        = 1 - p['h'] * p['h'] * p['h'] * .01;\n    _deltaSlide   = -p['i'] * p['i'] * p['i'] * .000001;\n\n    if (!p['a']) {\n      _squareDuty = .5 - p['n'] / 2;\n      _dutySweep  = -p['o'] * .00005;\n    }\n\n    _changeAmount =  1 + p['l'] * p['l'] * (p['l'] > 0 ? -.9 : 10);\n    _changeTime   = 0;\n    _changeLimit  = p['m'] == 1 ? 0 : (1 - p['m']) * (1 - p['m']) * 20000 + 32;\n  }\n\n  // I split the reset() function into two functions for better readability\n  this.totalReset = function() {\n    this.reset();\n\n    // Shorter reference\n    var p = this._params;\n\n    // Calculating the length is all that remained here, everything else moved somewhere\n    _envelopeLength0 = p['b']  * p['b']  * 100000;\n    _envelopeLength1 = p['c'] * p['c'] * 100000;\n    _envelopeLength2 = p['e']   * p['e']   * 100000 + 12;\n    // Full length of the volume envelop (and therefore sound)\n    // Make sure the length can be divided by 3 so we will not need the padding \"==\" after base64 encode\n    return ((_envelopeLength0 + _envelopeLength1 + _envelopeLength2) / 3 | 0) * 3;\n  }\n\n  /**\n   * Writes the wave to the supplied buffer ByteArray\n   * @param buffer A ByteArray to write the wave to\n   * @return If the wave is finished\n   */\n  this.synthWave = function(buffer, length) {\n    // Shorter reference\n    var p = this._params;\n\n    // If the filters are active\n    var _filters = p['s'] != 1 || p['v'],\n        // Cutoff multiplier which adjusts the amount the wave position can move\n        _hpFilterCutoff = p['v'] * p['v'] * .1,\n        // Speed of the high-pass cutoff multiplier\n        _hpFilterDeltaCutoff = 1 + p['w'] * .0003,\n        // Cutoff multiplier which adjusts the amount the wave position can move\n        _lpFilterCutoff = p['s'] * p['s'] * p['s'] * .1,\n        // Speed of the low-pass cutoff multiplier\n        _lpFilterDeltaCutoff = 1 + p['t'] * .0001,\n        // If the low pass filter is active\n        _lpFilterOn = p['s'] != 1,\n        // masterVolume * masterVolume (for quick calculations)\n        _masterVolume = p['x'] * p['x'],\n        // Minimum frequency before stopping\n        _minFreqency = p['g'],\n        // If the phaser is active\n        _phaser = p['q'] || p['r'],\n        // Change in phase offset\n        _phaserDeltaOffset = p['r'] * p['r'] * p['r'] * .2,\n        // Phase offset for phaser effect\n        _phaserOffset = p['q'] * p['q'] * (p['q'] < 0 ? -1020 : 1020),\n        // Once the time reaches this limit, some of the    iables are reset\n        _repeatLimit = p['p'] ? ((1 - p['p']) * (1 - p['p']) * 20000 | 0) + 32 : 0,\n        // The punch factor (louder at begining of sustain)\n        _sustainPunch = p['d'],\n        // Amount to change the period of the wave by at the peak of the vibrato wave\n        _vibratoAmplitude = p['j'] / 2,\n        // Speed at which the vibrato phase moves\n        _vibratoSpeed = p['k'] * p['k'] * .01,\n        // The type of wave to generate\n        _waveType = p['a'];\n\n    var _envelopeLength      = _envelopeLength0,     // Length of the current envelope stage\n        _envelopeOverLength0 = 1 / _envelopeLength0, // (for quick calculations)\n        _envelopeOverLength1 = 1 / _envelopeLength1, // (for quick calculations)\n        _envelopeOverLength2 = 1 / _envelopeLength2; // (for quick calculations)\n\n    // Damping muliplier which restricts how fast the wave position can move\n    var _lpFilterDamping = 5 / (1 + p['u'] * p['u'] * 20) * (.01 + _lpFilterCutoff);\n    if (_lpFilterDamping > .8) {\n      _lpFilterDamping = .8;\n    }\n    _lpFilterDamping = 1 - _lpFilterDamping;\n\n    var _finished = false,     // If the sound has finished\n        _envelopeStage    = 0, // Current stage of the envelope (attack, sustain, decay, end)\n        _envelopeTime     = 0, // Current time through current enelope stage\n        _envelopeVolume   = 0, // Current volume of the envelope\n        _hpFilterPos      = 0, // Adjusted wave position after high-pass filter\n        _lpFilterDeltaPos = 0, // Change in low-pass wave position, as allowed by the cutoff and damping\n        _lpFilterOldPos,       // Previous low-pass wave position\n        _lpFilterPos      = 0, // Adjusted wave position after low-pass filter\n        _periodTemp,           // Period modified by vibrato\n        _phase            = 0, // Phase through the wave\n        _phaserInt,            // Integer phaser offset, for bit maths\n        _phaserPos        = 0, // Position through the phaser buffer\n        _pos,                  // Phase expresed as a Number from 0-1, used for fast sin approx\n        _repeatTime       = 0, // Counter for the repeats\n        _sample,               // Sub-sample calculated 8 times per actual sample, averaged out to get the super sample\n        _superSample,          // Actual sample writen to the wave\n        _vibratoPhase     = 0; // Phase through the vibrato sine wave\n\n    // Buffer of wave values used to create the out of phase second wave\n    var _phaserBuffer = new Array(1024),\n        // Buffer of random values used to generate noise\n        _noiseBuffer  = new Array(32);\n    for (var i = _phaserBuffer.length; i--; ) {\n      _phaserBuffer[i] = 0;\n    }\n    for (var i = _noiseBuffer.length; i--; ) {\n      _noiseBuffer[i] = Math.random() * 2 - 1;\n    }\n\n    for (var i = 0; i < length; i++) {\n      if (_finished) {\n        return i;\n      }\n\n      // Repeats every _repeatLimit times, partially resetting the sound parameters\n      if (_repeatLimit) {\n        if (++_repeatTime >= _repeatLimit) {\n          _repeatTime = 0;\n          this.reset();\n        }\n      }\n\n      // If _changeLimit is reached, shifts the pitch\n      if (_changeLimit) {\n        if (++_changeTime >= _changeLimit) {\n          _changeLimit = 0;\n          _period *= _changeAmount;\n        }\n      }\n\n      // Acccelerate and apply slide\n      _slide += _deltaSlide;\n      _period *= _slide;\n\n      // Checks for frequency getting too low, and stops the sound if a minFrequency was set\n      if (_period > _maxPeriod) {\n        _period = _maxPeriod;\n        if (_minFreqency > 0) {\n          _finished = true;\n        }\n      }\n\n      _periodTemp = _period;\n\n      // Applies the vibrato effect\n      if (_vibratoAmplitude > 0) {\n        _vibratoPhase += _vibratoSpeed;\n        _periodTemp *= 1 + Math.sin(_vibratoPhase) * _vibratoAmplitude;\n      }\n\n      _periodTemp |= 0;\n      if (_periodTemp < 8) {\n        _periodTemp = 8;\n      }\n\n      // Sweeps the square duty\n      if (!_waveType) {\n        _squareDuty += _dutySweep;\n        if (_squareDuty < 0) {\n          _squareDuty = 0;\n        } else if (_squareDuty > .5) {\n          _squareDuty = .5;\n        }\n      }\n\n      // Moves through the different stages of the volume envelope\n      if (++_envelopeTime > _envelopeLength) {\n        _envelopeTime = 0;\n\n        switch (++_envelopeStage)  {\n          case 1:\n            _envelopeLength = _envelopeLength1;\n            break;\n          case 2:\n            _envelopeLength = _envelopeLength2;\n        }\n      }\n\n      // Sets the volume based on the position in the envelope\n      switch (_envelopeStage) {\n        case 0:\n          _envelopeVolume = _envelopeTime * _envelopeOverLength0;\n          break;\n        case 1:\n          _envelopeVolume = 1 + (1 - _envelopeTime * _envelopeOverLength1) * 2 * _sustainPunch;\n          break;\n        case 2:\n          _envelopeVolume = 1 - _envelopeTime * _envelopeOverLength2;\n          break;\n        case 3:\n          _envelopeVolume = 0;\n          _finished = true;\n      }\n\n      // Moves the phaser offset\n      if (_phaser) {\n        _phaserOffset += _phaserDeltaOffset;\n        _phaserInt = _phaserOffset | 0;\n        if (_phaserInt < 0) {\n          _phaserInt = -_phaserInt;\n        } else if (_phaserInt > 1023) {\n          _phaserInt = 1023;\n        }\n      }\n\n      // Moves the high-pass filter cutoff\n      if (_filters && _hpFilterDeltaCutoff) {\n        _hpFilterCutoff *= _hpFilterDeltaCutoff;\n        if (_hpFilterCutoff < .00001) {\n          _hpFilterCutoff = .00001;\n        } else if (_hpFilterCutoff > .1) {\n          _hpFilterCutoff = .1;\n        }\n      }\n\n      _superSample = 0;\n      for (var j = 8; j--; ) {\n        // Cycles through the period\n        _phase++;\n        if (_phase >= _periodTemp) {\n          _phase %= _periodTemp;\n\n          // Generates new random noise for this period\n          if (_waveType == 3) {\n            for (var n = _noiseBuffer.length; n--; ) {\n              _noiseBuffer[n] = Math.random() * 2 - 1;\n            }\n          }\n        }\n\n        // Gets the sample from the oscillator\n        switch (_waveType) {\n          case 0: // Square wave\n            _sample = ((_phase / _periodTemp) < _squareDuty) ? .5 : -.5;\n            break;\n          case 1: // Saw wave\n            _sample = 1 - _phase / _periodTemp * 2;\n            break;\n          case 2: // Sine wave (fast and accurate approx)\n            _pos = _phase / _periodTemp;\n            _pos = (_pos > .5 ? _pos - 1 : _pos) * 6.28318531;\n            _sample = 1.27323954 * _pos + .405284735 * _pos * _pos * (_pos < 0 ? 1 : -1);\n            _sample = .225 * ((_sample < 0 ? -1 : 1) * _sample * _sample  - _sample) + _sample;\n            break;\n          case 3: // Noise\n            _sample = _noiseBuffer[Math.abs(_phase * 32 / _periodTemp | 0)];\n        }\n\n        // Applies the low and high pass filters\n        if (_filters) {\n          _lpFilterOldPos = _lpFilterPos;\n          _lpFilterCutoff *= _lpFilterDeltaCutoff;\n          if (_lpFilterCutoff < 0) {\n            _lpFilterCutoff = 0;\n          } else if (_lpFilterCutoff > .1) {\n            _lpFilterCutoff = .1;\n          }\n\n          if (_lpFilterOn) {\n            _lpFilterDeltaPos += (_sample - _lpFilterPos) * _lpFilterCutoff;\n            _lpFilterDeltaPos *= _lpFilterDamping;\n          } else {\n            _lpFilterPos = _sample;\n            _lpFilterDeltaPos = 0;\n          }\n\n          _lpFilterPos += _lpFilterDeltaPos;\n\n          _hpFilterPos += _lpFilterPos - _lpFilterOldPos;\n          _hpFilterPos *= 1 - _hpFilterCutoff;\n          _sample = _hpFilterPos;\n        }\n\n        // Applies the phaser effect\n        if (_phaser) {\n          _phaserBuffer[_phaserPos % 1024] = _sample;\n          _sample += _phaserBuffer[(_phaserPos - _phaserInt + 1024) % 1024];\n          _phaserPos++;\n        }\n\n        _superSample += _sample;\n      }\n\n      // Averages out the super samples and applies volumes\n      _superSample *= .125 * _envelopeVolume * _masterVolume;\n\n      // Clipping if too loud\n      buffer[i] = _superSample >= 1 ? 32767 : _superSample <= -1 ? -32768 : _superSample * 32767 | 0;\n    }\n\n    return length;\n  }\n}\n\n// Adapted from http://codebase.es/riffwave/\nvar synth = new SfxrSynth();\n// Export for the Closure Compiler\nvar jsfxr = function(settings) {\n  // Initialize SfxrParams\n  synth._params.setSettings(settings);\n  // Synthesize Wave\n  var envelopeFullLength = synth.totalReset();\n  var data = new Uint8Array(((envelopeFullLength + 1) / 2 | 0) * 4 + 44);\n  var used = synth.synthWave(new Uint16Array(data.buffer, 44), envelopeFullLength) * 2;\n  var dv = new Uint32Array(data.buffer, 0, 44);\n  // Initialize header\n  dv[0] = 0x46464952; // \"RIFF\"\n  dv[1] = used + 36;  // put total size here\n  dv[2] = 0x45564157; // \"WAVE\"\n  dv[3] = 0x20746D66; // \"fmt \"\n  dv[4] = 0x00000010; // size of the following\n  dv[5] = 0x00010001; // Mono: 1 channel, PCM format\n  dv[6] = 0x0000AC44; // 44,100 samples per second\n  dv[7] = 0x00015888; // byte rate: two bytes per sample\n  dv[8] = 0x00100002; // 16 bits per sample, aligned on every two bytes\n  dv[9] = 0x61746164; // \"data\"\n  dv[10] = used;      // put number of samples here\n\n  // Base64 encoding written by me, @maettig\n  used += 44;\n  var i = 0,\n      base64Characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',\n      output = 'data:audio/wav;base64,';\n  for (; i < used; i += 3)\n  {\n    var a = data[i] << 16 | data[i + 1] << 8 | data[i + 2];\n    output += base64Characters[a >> 18] + base64Characters[a >> 12 & 63] + base64Characters[a >> 6 & 63] + base64Characters[a & 63];\n  }\n  return output;\n}\n\nif (typeof require === 'function') {\n  module.exports = jsfxr;\n}\nelse {\n  this.jsfxr = jsfxr;\n}\n","namespace Game {\r\n\r\n    export class Box {\r\n\r\n        pos: Vec;\r\n        w: number;\r\n        h: number;\r\n\r\n        constructor(pos: Vec, w: number, h: number){\r\n            this.pos = pos;\r\n            this.w = w;\r\n            this.h = h;\r\n        }\r\n\r\n        test(box: Box): boolean {\r\n            return this.pos.x < box.pos.x + box.w &&\r\n                this.pos.x + this.w > box.pos.x &&\r\n                this.pos.y < box.pos.y + box.h &&\r\n                this.h + this.pos.y > box.pos.y;\r\n        }\r\n\r\n        intersect(box: Box): Box {\r\n            let Ax = this.pos.x,\r\n                Ay = this.pos.y,\r\n                AX = Ax + this.w,\r\n                AY = Ay + this.h,\r\n                Bx = box.pos.x,\r\n                By = box.pos.y,\r\n                BX = Bx + box.w,\r\n                BY = By + box.h,\r\n                Cx = Ax < Bx ? Bx : Ax,\r\n                Cy = Ay < By ? By : Ay,\r\n                CX = AX < BX ? AX : BX,\r\n                CY = AY < BY ? AY : BY;\r\n            return new Box(\r\n                new Vec(Cx, Cy),\r\n                CX - Cx,\r\n                CY- Cy\r\n            );\r\n        }\r\n\r\n    }\r\n\r\n}","namespace Game {\r\n\r\n    export class Hero {\r\n        \r\n        sprite: Sprite;\r\n        speed: Vec;\r\n        box: Box;\r\n        face: number = 0;\r\n        walk: boolean = true;\r\n        frame: number = 1;\r\n\r\n        constructor(x: number, y: number, sprite: Sprite) {\r\n            this.sprite = sprite;\r\n            this.speed = new Vec(0, 1);\r\n            this.box = new Box(new Vec(x, y), 16, 24);\r\n        }\r\n\r\n        render(ctx: CanvasRenderingContext2D, width: number): void  {\r\n            let box = this.box,\r\n                pos = box.pos,\r\n                x = pos.x,\r\n                y = pos.y,\r\n                w = box.w,\r\n                h = box.h,\r\n                top = this.face * h,\r\n                walk = this.walk,\r\n                frame = this.frame,\r\n                sprite = this.sprite;\r\n            if (walk) {\r\n                frame = frame < 3 ? frame : 1;\r\n                sprite.render(ctx, x, y, w, h, top, frame + 1);\r\n            } else {\r\n                sprite.render(ctx, x, y, w, h, top, 0);\r\n                sprite.render(ctx, x, y, w, h, top, frame + 4);\r\n            }\r\n            if (pos.x + box.w > width) {\r\n                x -= width;\r\n                if (walk) {\r\n                    sprite.render(ctx, x, y, w, h, top, frame + 1);\r\n                } else {\r\n                    sprite.render(ctx, x, y, w, h, top, 0);\r\n                    sprite.render(ctx, x, y, w, h, top, frame + 4);\r\n                }\r\n            }\r\n        }\r\n\r\n        update(tick: number) {\r\n            if (tick % 8 == 0) {\r\n                if (!this.walk) {\r\n                    this.frame = ++this.frame % 3;\r\n                } else if (this.speed.x != 0) {\r\n                    this.frame = ++this.frame % 4;\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n}","namespace Game {\r\n\r\n    export class Platform {\r\n\r\n        box: Box;\r\n\r\n        constructor(x: number, y: number, width: number, height: number) {\r\n            this.box = new Box(new Vec(x, y), width, height);\r\n        }\r\n\r\n        render(ctx: CanvasRenderingContext2D, sprite: Sprite): void {\r\n            const box = this.box;\r\n            ctx.fillStyle = '#0ff';\r\n            ctx.fillRect(box.pos.x, box.pos.y, box.w, box.h);\r\n        }\r\n\r\n    }\r\n\r\n}","namespace Game {\r\n\r\n    export class Scene {\r\n\r\n        sprite: Sprite;\r\n        tick: number = 0;\r\n        hero: Hero;\r\n        ship: Ship;\r\n        width: number = 256;\r\n        cache: HTMLImageElement;\r\n        platforms: Platform[];\r\n\r\n        constructor(ctx: CanvasRenderingContext2D, img: HTMLImageElement) {\r\n            this.sprite = new Sprite(img);\r\n            this.hero = new Hero(96, 160, this.sprite.crop(ctx, 0, 0, 112, 48));\r\n            this.ship = new Ship(160, 136, this.sprite.crop(ctx, 0, 88, 48, 48));\r\n            this.platforms = [\r\n                new Platform(-50, 0, 350, 16),\r\n                new Platform(32, 72, 48, 8),\r\n                new Platform(120, 96, 32, 8),\r\n                new Platform(192, 48, 48, 8),\r\n                new Platform(-50, 184, 350, 8),\r\n            ];\r\n        }\r\n\r\n        back(ctx: CanvasRenderingContext2D): void {\r\n            if (this.cache) {\r\n                ctx.drawImage(this.cache, 0, 0);\r\n                return;\r\n            }\r\n            let sky = ctx.createLinearGradient(0, 0, 0, 192);\r\n            sky.addColorStop(0, \"#002\");\r\n            sky.addColorStop(1, \"#224\");\r\n            ctx.fillStyle = sky;\r\n            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n            for (let i = 1; i < this.platforms.length; i++) {\r\n                let box = this.platforms[i].box,\r\n                    x = box.pos.x,\r\n                    y = box.pos.y,\r\n                    j = 8;\r\n                this.sprite.render(ctx, x, y, j, 8, 80, 0);\r\n                for (; j < box.w - 8; j += 8) {\r\n                    this.sprite.render(ctx, x + j, y, 8, 8, 80, 1);\r\n                }\r\n                this.sprite.render(ctx, x + j, y, 8, 8, 80, 2);\r\n            }\r\n            this.cache = new Image();\r\n            this.cache.src = ctx.canvas.toDataURL();\r\n        }\r\n\r\n        render(ctx: CanvasRenderingContext2D): void {\r\n            this.back(ctx);\r\n            this.ship.render(ctx);\r\n            this.hero.render(ctx, this.width);\r\n        }\r\n\r\n        update(): void {\r\n            let hero = this.hero,\r\n                speed = hero.speed,\r\n                pos = hero.box.pos,\r\n                old = pos.clone(),\r\n                walk = false;\r\n            hero.update(this.tick++);\r\n            pos.x += speed.x;\r\n            if (pos.x > this.width) {\r\n                pos.x -= this.width;\r\n            } else if (pos.x < 0) {\r\n                pos.x += this.width;\r\n            }\r\n            this.platforms.forEach(platform => {\r\n                if (platform.box.test(hero.box)) {\r\n                    pos.x = old.x;\r\n                }\r\n            });\r\n            pos.y += speed.y;\r\n            this.platforms.forEach(platform => {\r\n                if (platform.box.test(hero.box)) {\r\n                    pos.y = old.y;\r\n                    if (speed.y > 0) {\r\n                        walk = true;\r\n                    }\r\n                }\r\n            });\r\n            hero.walk = walk;\r\n        }\r\n\r\n    }\r\n\r\n}","namespace Game {\r\n\r\n    export class Ship {\r\n\r\n        sprite: Sprite;\r\n        boxes: Box[];\r\n\r\n        constructor(x, y, sprite: Sprite) {\r\n            this.sprite = sprite;\r\n            this.boxes = [\r\n                new Box(new Vec(x, y), 16, 16),\r\n                new Box(new Vec(x, y + 16), 16, 16),\r\n                new Box(new Vec(x, y + 32), 16, 16),\r\n            ];\r\n        }\r\n        \r\n        render(ctx: CanvasRenderingContext2D): void  {\r\n            this.boxes.forEach((box, i) => {\r\n                let pos = box.pos,\r\n                    top = box.h * i;\r\n                this.sprite.render(ctx, pos.x, pos.y, box.w, box.h, top, 0);\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n}","namespace Game {\r\n\r\n    export class Sprite {\r\n\r\n        img: HTMLImageElement;\r\n\r\n        constructor(img: HTMLImageElement) {\r\n            this.img = img;\r\n        }\r\n\r\n        render(ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number, top:number, frame: number): void {\r\n            ctx.drawImage(this.img, w * frame, top, w, h, x, y, w, h);\r\n        }\r\n\r\n        crop(ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number, flipV: boolean = false, flipH: boolean = false) {\r\n            let img = new Image(),\r\n                canvas = ctx.canvas,\r\n                width = canvas.width,\r\n                height = canvas.height;\r\n            canvas.width = w;\r\n            canvas.height = h;\r\n            ctx.save();\r\n            ctx.translate(flipV ? w : 0, flipH ? h : 0);\r\n            ctx.scale(flipV ? -1 : 1, flipH ? -1 : 1);\r\n            ctx.drawImage(this.img, -x, -y);\r\n            ctx.restore();\r\n            img.src = canvas.toDataURL();\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n            return new Sprite(img);\r\n        }\r\n    }\r\n\r\n}","namespace Game {\r\n\r\n    export class Vec {\r\n\r\n        x: number;\r\n        y: number;\r\n\r\n        constructor(x: number, y: number) {\r\n            this.x = x;\r\n            this.y = y;\r\n        }\r\n\r\n        clone(): Vec {\r\n            return new Vec(this.x, this.y);\r\n        }\r\n    }\r\n}","/// <reference path=\"../typings/index.d.ts\" />\r\n\r\nnamespace Game {\r\n\r\n    function $(query: string, element?: NodeSelector): Element {\r\n        return (element || document).querySelector(query);\r\n    }\r\n\r\n    function on(element: any, event: string, callback: EventListenerOrEventListenerObject) {\r\n        element.addEventListener(event, callback, false);\r\n    }\r\n\r\n    let canvas: HTMLCanvasElement,\r\n        ctx: CanvasRenderingContext2D,\r\n        scene: Scene;\r\n\r\n    function resize(): void {\r\n        let body = document.body,\r\n            portrait = body.clientWidth / body.clientHeight < canvas.width / canvas.height;\r\n        canvas.style.width = portrait ? '100%' : '';\r\n        canvas.style.height = portrait ? '' : '100%';\r\n    }\r\n    \r\n    function bind(): void {\r\n        const hero = scene.hero;\r\n        on(document, 'keydown', (e: KeyboardEvent) => {\r\n            let key = e.keyCode;\r\n            if (key == 38 || key == 87 || key == 119) {\r\n                hero.speed.y = -1;\r\n            } else if (key == 37 || key == 65 || key == 97) {\r\n                hero.speed.x = -1;\r\n                hero.face = 0;\r\n            } else if (key == 39 || key == 68 || key == 100) {\r\n                hero.speed.x = 1;\r\n                hero.face = 1;\r\n            }\r\n        });\r\n        on(document, 'keyup', (e: KeyboardEvent) => {\r\n            let key = e.keyCode;\r\n            if (key == 38 || key == 87 || key == 119 || key == 40 || key == 83 || key == 115) {\r\n                hero.speed.y = 1;\r\n            } else if (key == 37 || key == 65 || key == 97 || key == 39 || key == 68 || key == 100) {\r\n                hero.speed.x = 0;\r\n            }\r\n        });\r\n        on(window, 'resize', resize);\r\n    }\r\n\r\n    function update(): void {\r\n        requestAnimationFrame(() => {\r\n            update();\r\n        });\r\n        scene.update();\r\n        scene.render(ctx);\r\n    }\r\n\r\n    on(window, 'load', () => {\r\n        const img = <HTMLImageElement>$('#sprite');\r\n        canvas = <HTMLCanvasElement>$('#game');\r\n        ctx = canvas.getContext('2d');\r\n        scene = new Scene(ctx, img);\r\n        bind();\r\n        resize();\r\n        update();\r\n    });\r\n}"]}